-- Test Data Generation for purgo_playground.enriched_patient_therapy_shipment
-- Includes happy path, edge, error, NULL, and special character scenarios

WITH test_data AS (
  SELECT
    -- Happy path: all fields present, numeric days_supply and qty
    'DrugA' AS product,
    DATE('2024-01-01') AS ship_date,
    '28' AS days_supply,
    '84' AS qty,
    'TREAT123' AS treatment_id,
    DATE('1980-05-10') AS dob,
    DATE('2024-01-01') AS first_ship_date,
    'DC - Standard' AS refill_status,
    'PAT001' AS patient_id,
    'commercial' AS ship_type,
    'arrived' AS shipment_arrived_status,
    'yes' AS delivery_ontime,
    DATE('2024-01-29') AS shipment_expiry,
    DATE('2024-04-29') AS discontinuation_date,
    28 AS days_until_next_ship,
    32 AS days_since_last_fill,
    DATE('2024-01-29') AS expected_refill_date,
    NULL AS prior_ship,
    NULL AS days_between,
    NULL AS days_since_supply_out,
    44 AS age,
    44 AS age_at_first_ship,
    2 AS latest_therapy_ships,
    'STANDARD' AS discontinuation_type
  UNION ALL
  -- Happy path: days_supply NULL, qty present
  SELECT
    'DrugB',
    DATE('2024-03-15'),
    NULL,
    '63',
    'TREAT456',
    DATE('1975-12-20'),
    DATE('2024-03-15'),
    'DC-PERMANENT',
    'PAT002',
    'commercial',
    'arrived',
    'no',
    DATE('2024-03-29'),
    DATE('2024-06-28'),
    29,
    18,
    DATE('2024-03-29'),
    NULL,
    NULL,
    NULL,
    48,
    48,
    1,
    'PERMANENT'
  UNION ALL
  -- Happy path: sample shipment, not commercial
  SELECT
    'DrugC',
    DATE('2024-05-10'),
    '30',
    '90',
    'TREAT789',
    DATE('1990-07-01'),
    DATE('2024-05-10'),
    'ongoing',
    'PAT003',
    'sample',
    'pending',
    'yes',
    DATE('2024-06-09'),
    DATE('2024-09-08'),
    30,
    22,
    DATE('2024-06-09'),
    NULL,
    NULL,
    NULL,
    33,
    33,
    0,
    NULL
  UNION ALL
  -- NULL days_supply and qty, should result in NULL derived fields
  SELECT
    'DrugD',
    DATE('2024-01-01'),
    NULL,
    NULL,
    'TREAT999',
    NULL,
    DATE('2024-01-01'),
    'DC - Standard',
    'PAT004',
    'commercial',
    'arrived',
    'yes',
    NULL,
    NULL,
    NULL,
    32,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    1,
    'STANDARD'
  UNION ALL
  -- NULL first_ship_date, age_at_first_ship should be NULL
  SELECT
    'DrugE',
    DATE('2024-03-15'),
    '30',
    NULL,
    'TREAT888',
    DATE('1985-11-11'),
    NULL,
    'DC-PERMANENT',
    'PAT005',
    'commercial',
    'arrived',
    'no',
    DATE('2024-04-14'),
    DATE('2024-07-14'),
    31,
    18,
    DATE('2024-04-14'),
    NULL,
    NULL,
    NULL,
    38,
    NULL,
    1,
    'PERMANENT'
  UNION ALL
  -- NULL dob and first_ship_date, age and age_at_first_ship should be NULL
  SELECT
    'DrugF',
    DATE('2024-05-10'),
    NULL,
    NULL,
    'TREAT777',
    NULL,
    NULL,
    'ongoing',
    'PAT006',
    'sample',
    'pending',
    'yes',
    NULL,
    NULL,
    NULL,
    22,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    0,
    NULL
  UNION ALL
  -- Error: non-numeric days_supply, should set derived fields to NULL
  SELECT
    'DrugG',
    DATE('2024-01-01'),
    'abc',
    '84',
    'TREAT555',
    DATE('1980-05-10'),
    DATE('2024-01-01'),
    'DC - Standard',
    'PAT007',
    'commercial',
    'arrived',
    'yes',
    NULL,
    NULL,
    NULL,
    32,
    NULL,
    NULL,
    NULL,
    44,
    44,
    1,
    'STANDARD'
  UNION ALL
  -- Error: non-numeric qty, should set derived fields to NULL
  SELECT
    'DrugH',
    DATE('2024-03-15'),
    '30',
    'xyz',
    'TREAT444',
    DATE('1975-12-20'),
    DATE('2024-03-15'),
    'DC-PERMANENT',
    'PAT008',
    'commercial',
    'arrived',
    'no',
    NULL,
    NULL,
    NULL,
    18,
    NULL,
    NULL,
    NULL,
    48,
    48,
    1,
    'PERMANENT'
  UNION ALL
  -- Edge: days_supply = 0, should handle as 0-day supply
  SELECT
    'DrugI',
    DATE('2024-02-01'),
    '0',
    '0',
    'TREAT321',
    DATE('2000-01-01'),
    DATE('2024-02-01'),
    'ongoing',
    'PAT009',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-02-01'),
    DATE('2024-05-02'),
    1,
    1,
    DATE('2024-02-01'),
    NULL,
    NULL,
    NULL,
    24,
    24,
    1,
    NULL
  UNION ALL
  -- Edge: days_supply = 1, minimal supply
  SELECT
    'DrugJ',
    DATE('2024-02-02'),
    '1',
    '3',
    'TREAT654',
    DATE('2010-12-31'),
    DATE('2024-02-02'),
    'ongoing',
    'PAT010',
    'commercial',
    'arrived',
    'no',
    DATE('2024-02-03'),
    DATE('2024-05-05'),
    2,
    1,
    DATE('2024-02-03'),
    NULL,
    NULL,
    NULL,
    13,
    13,
    1,
    NULL
  UNION ALL
  -- Edge: days_supply = 365, 1 year supply
  SELECT
    'DrugK',
    DATE('2023-01-01'),
    '365',
    '1095',
    'TREAT987',
    DATE('1960-06-15'),
    DATE('2023-01-01'),
    'ongoing',
    'PAT011',
    'commercial',
    'arrived',
    'yes',
    DATE('2023-12-31'),
    DATE('2024-04-01'),
    365,
    397,
    DATE('2023-12-31'),
    NULL,
    NULL,
    NULL,
    64,
    64,
    1,
    NULL
  UNION ALL
  -- Edge: qty = 0, days_supply present
  SELECT
    'DrugL',
    DATE('2024-03-01'),
    '30',
    '0',
    'TREAT654',
    DATE('1995-03-01'),
    DATE('2024-03-01'),
    'ongoing',
    'PAT012',
    'commercial',
    'arrived',
    'no',
    DATE('2024-03-31'),
    DATE('2024-06-30'),
    31,
    1,
    DATE('2024-03-31'),
    NULL,
    NULL,
    NULL,
    29,
    29,
    1,
    NULL
  UNION ALL
  -- Edge: qty present, days_supply NULL, qty not divisible by 3
  SELECT
    'DrugM',
    DATE('2024-04-01'),
    NULL,
    '50',
    'TREAT321',
    DATE('1988-08-08'),
    DATE('2024-04-01'),
    'ongoing',
    'PAT013',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-04-11'),
    DATE('2024-07-11'),
    11,
    1,
    DATE('2024-04-11'),
    NULL,
    NULL,
    NULL,
    35,
    35,
    1,
    NULL
  UNION ALL
  -- Special: special characters in product and patient_id
  SELECT
    'DrügN-测试',
    DATE('2024-05-05'),
    '14',
    '42',
    'TREAT特殊',
    DATE('1999-12-31'),
    DATE('2024-05-05'),
    'ongoing',
    'PAT特殊-测试',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-05-19'),
    DATE('2024-08-18'),
    15,
    27,
    DATE('2024-05-19'),
    NULL,
    NULL,
    NULL,
    24,
    24,
    1,
    NULL
  UNION ALL
  -- Special: multi-byte and emoji in product
  SELECT
    '💊DrugO',
    DATE('2024-06-06'),
    '21',
    '63',
    'TREATEMOJI',
    DATE('2002-02-02'),
    DATE('2024-06-06'),
    'ongoing',
    'PAT014',
    'commercial',
    'arrived',
    'no',
    DATE('2024-06-27'),
    DATE('2024-09-26'),
    22,
    26,
    DATE('2024-06-27'),
    NULL,
    NULL,
    NULL,
    22,
    22,
    1,
    NULL
  UNION ALL
  -- Edge: refill_status NULL, discontinuation_type should be NULL
  SELECT
    'DrugP',
    DATE('2024-07-07'),
    '30',
    '90',
    'TREATNULL',
    DATE('1985-05-05'),
    DATE('2024-07-07'),
    NULL,
    'PAT015',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-08-06'),
    DATE('2024-11-05'),
    31,
    1,
    DATE('2024-08-06'),
    NULL,
    NULL,
    NULL,
    39,
    39,
    1,
    NULL
  UNION ALL
  -- Edge: shipment_arrived_status NULL
  SELECT
    'DrugQ',
    DATE('2024-08-08'),
    '30',
    '90',
    'TREATNULL2',
    DATE('1992-09-09'),
    DATE('2024-08-08'),
    'ongoing',
    'PAT016',
    'commercial',
    NULL,
    'no',
    DATE('2024-09-07'),
    DATE('2024-12-07'),
    31,
    1,
    DATE('2024-09-07'),
    NULL,
    NULL,
    NULL,
    31,
    31,
    1,
    NULL
  UNION ALL
  -- Edge: delivery_ontime NULL
  SELECT
    'DrugR',
    DATE('2024-09-09'),
    '30',
    '90',
    'TREATNULL3',
    DATE('1970-10-10'),
    DATE('2024-09-09'),
    'ongoing',
    'PAT017',
    'commercial',
    'arrived',
    NULL,
    DATE('2024-10-09'),
    DATE('2025-01-08'),
    31,
    1,
    DATE('2024-10-09'),
    NULL,
    NULL,
    NULL,
    53,
    53,
    1,
    NULL
  UNION ALL
  -- Edge: ship_type not commercial, latest_therapy_ships = 0
  SELECT
    'DrugS',
    DATE('2024-10-10'),
    '30',
    '90',
    'TREATNONCOMM',
    DATE('1988-11-11'),
    DATE('2024-10-10'),
    'ongoing',
    'PAT018',
    'sample',
    'arrived',
    'yes',
    DATE('2024-11-09'),
    DATE('2025-02-08'),
    31,
    1,
    DATE('2024-11-09'),
    NULL,
    NULL,
    NULL,
    35,
    35,
    0,
    NULL
  UNION ALL
  -- Edge: refill_status = 'ongoing', discontinuation_type = NULL
  SELECT
    'DrugT',
    DATE('2024-11-11'),
    '30',
    '90',
    'TREATONGO',
    DATE('1995-12-12'),
    DATE('2024-11-11'),
    'ongoing',
    'PAT019',
    'commercial',
    'arrived',
    'no',
    DATE('2024-12-11'),
    DATE('2025-03-13'),
    31,
    1,
    DATE('2024-12-11'),
    NULL,
    NULL,
    NULL,
    28,
    28,
    1,
    NULL
  UNION ALL
  -- Edge: prior_ship present, days_between calculated
  SELECT
    'DrugU',
    DATE('2024-12-12'),
    '30',
    '90',
    'TREATPRIOR',
    DATE('1980-01-01'),
    DATE('2024-12-12'),
    'ongoing',
    'PAT020',
    'commercial',
    'arrived',
    'yes',
    DATE('2025-01-11'),
    DATE('2025-04-12'),
    31,
    1,
    DATE('2025-01-11'),
    DATE('2024-11-12'),
    30,
    NULL,
    44,
    44,
    2,
    NULL
  UNION ALL
  -- Edge: days_since_supply_out present (supply out before calctime)
  SELECT
    'DrugV',
    DATE('2024-01-01'),
    '28',
    '84',
    'TREATGAP',
    DATE('1980-05-10'),
    DATE('2024-01-01'),
    'DC - Standard',
    'PAT021',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-01-29'),
    DATE('2024-04-29'),
    28,
    32,
    DATE('2024-01-29'),
    NULL,
    NULL,
    3,
    44,
    44,
    1,
    'STANDARD'
  UNION ALL
  -- Edge: days_since_supply_out NULL (supply not out yet)
  SELECT
    'DrugW',
    DATE('2024-12-01'),
    '28',
    '84',
    'TREATGAP2',
    DATE('1980-05-10'),
    DATE('2024-12-01'),
    'DC - Standard',
    'PAT022',
    'commercial',
    'arrived',
    'yes',
    DATE('2024-12-29'),
    DATE('2025-03-30'),
    28,
    1,
    DATE('2024-12-29'),
    NULL,
    NULL,
    NULL,
    44,
    44,
    1,
    'STANDARD'
  UNION ALL
  -- Edge: all NULLs except product and patient_id
  SELECT
    'DrugX',
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    'PAT023',
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL
  UNION ALL
  -- Special: whitespace and special char in delivery_ontime
  SELECT
    'DrugY',
    DATE('2024-06-15'),
    '30',
    '90',
    'TREATSPACE',
    DATE('1990-01-01'),
    DATE('2024-06-15'),
    'ongoing',
    'PAT024',
    'commercial',
    'arrived',
    ' 𝄞 ',
    DATE('2024-07-15'),
    DATE('2024-10-14'),
    31,
    1,
    DATE('2024-07-15'),
    NULL,
    NULL,
    NULL,
    34,
    34,
    1,
    NULL
  UNION ALL
  -- Special: negative qty (invalid, but string type)
  SELECT
    'DrugZ',
    DATE('2024-07-20'),
    '30',
    '-90',
    'TREATNEG',
    DATE('1985-07-20'),
    DATE('2024-07-20'),
    'ongoing',
    'PAT025',
    'commercial',
    'arrived',
    'no',
    DATE('2024-08-19'),
    DATE('2024-11-18'),
    31,
    1,
    DATE('2024-08-19'),
    NULL,
    NULL,
    NULL,
    39,
    39,
    1,
    NULL
)

SELECT * FROM test_data
;
